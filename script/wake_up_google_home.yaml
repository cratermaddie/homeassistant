wake_up_google_home:
  sequence:
    - service: media_player.turn_on
      entity_id: media_player.bedroom_speaker
    - wait_template: "{{ not is_state('media_player.bedroom_speaker', 'off') }}"
    - service: media_player.volume_set
      data_template:
        entity_id: media_player.bedroom_speaker
        volume_level: 0.8
    - service: media_player.play_media
      data:
        entity_id: media_player.bedroom_speaker
        media_content_id: !secret alarm_url
        media_content_type: 'music'
    - wait_template: "{{ is_state('media_player.bedroom_speaker', 'playing') }}"
    - wait_template: "{{ is_state('media_player.bedroom_speaker', 'paused') }}"
    - service: media_player.turn_off
      entity_id: media_player.bedroom_speaker
    - service: media_player.volume_set
      data_template:
        entity_id: media_player.bedroom_speaker
        volume_level: 0.5
    - condition: time
      before: "11:00:00"
    - service: tts.cloud_say
      entity_id: media_player.bedroom_speaker
      data_template:
        message: >-
          {% set space = "" %}

          {% set weekday = (now().timestamp()|float )|timestamp_custom('%A') %}
          {% set month = (now().timestamp()|float )|timestamp_custom('%B') %}
          {% set day = (now().timestamp()|float )|timestamp_custom('%-d') %}
          {% set is_birthday = (now().timestamp() | timestamp_custom('%d') | int  == as_timestamp(state_attr('calendar.birthdays','start_time')) | timestamp_custom('%d') | int) and (now().timestamp() | timestamp_custom('%m') | int == as_timestamp(state_attr('calendar.birthdays','start_time')) | timestamp_custom('%m') | int) %}
          {% set is_event = now().timestamp() | timestamp_custom('%d') | int  == as_timestamp(state_attr('calendar.personal_trigger','start_time')) | timestamp_custom('%d') | int %}
          {% set is_holiday = now().timestamp() | timestamp_custom('%d') | int  == as_timestamp(state_attr('calendar.holidays_in_united_states','start_time')) | timestamp_custom('%d') | int and (now().timestamp() | timestamp_custom('%m') | int == as_timestamp(state_attr('calendar.holidays_in_united_states','start_time')) | timestamp_custom('%m') | int) %}

          {% set event_time = (as_timestamp(state_attr('calendar.personal_trigger','start_time')) | int | timestamp_custom('%-H')) if (0 <= as_timestamp(state_attr('calendar.personal_trigger','start_time')) % 3600 <= 59) else (as_timestamp(state_attr('calendar.personal_trigger','start_time')) | timestamp_custom('%-H %M')) %}
          {% set summary = states('sensor.dark_sky_summary_0d') | replace('.', '') | lower if (day_offset) else states('sensor.dark_sky_summary_0d') | replace('.', '') | lower %}
          {% set high = states('sensor.dark_sky_daytime_high_temperature_0d') | int if (day_offset) else states('sensor.dark_sky_daytime_high_temperature_0d') |int %}
          {% set low = states('sensor.dark_sky_overnight_low_temperature_0d') | int if (day_offset) else states('sensor.dark_sky_overnight_low_temperature_0d') | int %}

          Good morning Madison! It is currently {{ (now().timestamp()|float )|timestamp_custom('%-H') }} {{ (now().timestamp()|float )|timestamp_custom('%-M') }} on {{ weekday }} the {% if day | int == 1 or day | int == 21 or day | int == 31 %}{{ day }}st{% elif day | int == 2 or day | int == 22 %}{{ day }}nd{% elif day | int == 3 or day | int == 23 %}{{ day }}rd{% else %}{{ day }}th{% endif %} of {{ month }}. {{ space }}Today's weather will be {{ summary }} with a high of {{ high }} and a low of {{ low }}. {{ space }}
          {%- if is_holiday -%}
          Today is {{ state_attr('calendar.holidays_in_united_states','message') | replace(" (regional holiday)","") }}. {{ space }}
          {%- endif -%}
          {%- if not is_holiday and is_birthday -%}
          Today is {{ space }}
          {%- elif is_birthday -%}
          and{{ space }}
          {%- endif -%}
          {%- if is_birthday -%}
          {{ state_attr('calendar.birthdays','message') }}! {{ space }}
          {%- endif -%}
          {%- if is_event -%}
          {{ state_attr('calendar.personal_trigger','message') }} starts at {{ event_time }}. {{ space }}
          {%- endif -%}
          {{- [
          "Have a good one",
          "Have a good day",
          "Enjoy your day"] | random -}}!