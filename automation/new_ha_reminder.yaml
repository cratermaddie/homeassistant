- alias: Update Available Notification
  mode: restart
  trigger:
    - platform: state
      entity_id: binary_sensor.home_assistant_website_update_available
      to: 'on'
  action:
    - service: notify.mobile_app_madisons_iphone
      data_template:
        message: "Home Assistant {{ states('sensor.home_assistant_website') }} is available."
        data:
          apns_headers:
            'apns-collapse-id': 'new-ha-version-reminder'
          push:
            thread-id: 'new-ha-version-reminder'
            sound: '3rdParty_Success_Haptic.caf'
          url: "{{ states('sensor.change_log_url') }}"
    - service: persistent_notification.create
      data_template:
        title: "New Home Assistant Version!"
        message: |
          Home Assistant {{ states('sensor.home_assistant_website') }} is available.
          {{ state_attr('sensor.home_assistant_website','release_title') }}
          {{ state_attr('sensor.home_assistant_website','release_description') }}
          [Change Log]({{ states('sensor.change_log_url') }})